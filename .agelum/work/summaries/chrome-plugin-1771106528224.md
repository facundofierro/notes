# Summary: Chrome Plugin Enhancement Implementation

**Date**: 2026-02-14
**Plan**: `.agelum/work/plans/chrome-plugin-1771106302323.md`

## Phases Implemented

### Phase 3: Plugin Configuration Settings (Web App)

**`apps/web/src/lib/settings.ts`**
- Added `pluginName?: string` and `pluginDomain?: string` to `ProjectConfig` interface
- Updated `saveProjectConfig` to persist these fields to `.agelum/config.json`
- Updated `saveSettings` to strip these fields from global settings (kept project-local)

**`apps/web/src/app/api/(auth)/users/route.ts`**
- Added `POST` handler to add a user email to `.agelum/config/users.json`
- Added `DELETE` handler to remove a user email from the whitelist

**`apps/web/src/components/features/settings/SettingsPlugin.tsx`**
- Complete rewrite with three sections:
  1. **Chrome Plugin API Keys** — existing key management (preserved)
  2. **Plugin Project Configuration** — per-project `pluginName` and `pluginDomain` fields with save button
  3. **Allowed Plugin Users** — email whitelist management (add/remove users)
- Receives `projectName` prop; shows a guide message when no project is selected

**`apps/web/src/components/features/settings/SettingsDialog.tsx`**
- Passes `projectName` prop to `<SettingsPlugin />`

### Phase 4: Inbox Backend Implementation (Web App)

**`apps/web/src/app/api/(content)/tasks/route.ts`**
- Added `"inbox"` to the `Task` interface state union type
- Added `reporter?: string`, `priority?: "low"|"medium"|"high"|"urgent"`, `sourceUrl?: string` to `Task` interface
- Added `inbox` and `images` directories to `ensureAgelumStructure`
- Updated `parseTaskFile` to extract `reporter`, `priority`, and `source` from frontmatter
- Updated `readTasksRecursively` and `readTasks` to include `inbox` state
- Updated `createTask` and `createTaskFromContent` to accept and persist `reporter`, `priority`, `sourceUrl`
- Updated frontmatter generation to write new metadata fields

### Phase 5: Kanban Inbox UI (Web App & Kanban Package)

**`packages/kanban/src/types.ts`**
- Added `narrow?: boolean` to `KanbanColumn` interface

**`packages/kanban/src/components/KanbanColumn.tsx`**
- Updated column container to use `flex-none w-[200px]` when `column.narrow === true`, otherwise standard flex layout

**`apps/web/src/components/features/kanban/TaskKanban.tsx`**
- Added `"inbox"` to the local `Task` state type with `reporter`, `priority`, `sourceUrl` fields
- Added **Inbox column** as the leftmost column (order: 0, color: "sky", narrow: true)
- Inbox tasks display `reporter` as an assignee and `priority` via the card's priority field
- Inbox tasks include `sourceUrl` in description (shown as "From: ...")
- Inbox tasks separated from other tasks and prepended to the visible list

### Phase 6: Chrome Plugin Integration

**`apps/chrome-plugin/src/shared/storage.ts`**
- Added `reporterEmail?: string` to `ConnectionSettings` interface and defaults

**`apps/chrome-plugin/src/shared/api-client.ts`**
- Added `reporter?: string` and `priority?: "low"|"medium"|"high"|"urgent"` to `CreateReportRequest`

**`apps/chrome-plugin/src/popup/App.tsx`**
- Added "Your Email (Reporter)" field to the settings form

**`apps/chrome-plugin/src/sidepanel/App.tsx`**
- Added `Priority` type and `priorityOptions` config (low/medium/high/urgent with color styles)
- Added `priority` state (default: "medium")
- Added priority selector UI in the "prompting" state (4-button grid)
- Updated `createReport` call: state changed from `"fixes"` to `"inbox"`, includes `reporter` from settings and selected `priority`
- Resets priority to "medium" on "Create Another"

**`apps/site/src/lib/task-creator.ts`**
- Added `reporter?: string` and `priority?: string` to `CreateTaskOptions`
- Writes `reporter` and `priority` to task frontmatter when present
- Fixed `source` field to use `opts.sourceUrl` (previously hardcoded `"chrome-plugin"`)

## Data Flow After Changes

```
1. User sets reporterEmail in popup settings
2. User opens side panel, captures screenshot
3. User selects priority (Low/Medium/High/Urgent) before submitting
4. Plugin sends POST /api/v1/reports with: state="inbox", reporter, priority, sourceUrl
5. Site app creates task in .agelum/work/tasks/inbox/ with reporter+priority in frontmatter
6. Web app Kanban shows the task in the leftmost "Inbox" column
7. Card shows reporter as assignee and priority indicator
8. Developer drags task to Backlog/Fixes/etc. to begin work
```

## Phases Not Implemented (Out of Scope for this Session)

- **Phase 1**: OAuth integration in Site app (requires external provider setup)
- **Phase 2**: Auth gateway route in Web app and login/logout UI (depends on Phase 1)
